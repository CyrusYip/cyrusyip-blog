<script>
  // Load script asynchronously
  function loadScript(url, delay, callback) {
    setTimeout(() => {
      const script = document.createElement("script");
      script.src = url;
      if (callback) script.onload = callback;
      script.async = true;
      document.body.appendChild(script);
    }, delay);
  }

  // Google Analytics
  loadScript(
    "https://www.googletagmanager.com/gtag/js?id=G-8TSPGDFPRC",
    100,
    function () {
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-8TSPGDFPRC");
      console.log("Google Analytics loaded")
    }
  );
</script>

{{/* Only load comment services for regular page */}}
{{ if .IsPage }}

{{- /* Set language */ -}}
{{ $disqusLanguage := "" }}
{{ $giscusLanguage := "" }}

{{ if eq .Language.Lang "zh-cn" }}
  {{ $giscusLanguage = "zh-CN" }}
  {{ $disqusLanguage = "zh" }}
{{ else }}
  {{ $giscusLanguage = "en" }}
  {{ $disqusLanguage = "en" }}
{{ end }}

{{- /* giscus */ -}}
<script>
function loadGiscus() {
  const script = document.createElement('script');
  script.src = 'https://giscus.app/client.js';
  script.setAttribute('data-repo', 'CyrusYip/blog-comments');
  script.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnkzNDg2NjkxMTQ=');
  script.setAttribute('data-category', 'Comments');
  script.setAttribute('data-category-id', 'DIC_kwDOFMhEus4ChUiV');
  script.setAttribute('data-mapping', 'pathname');
  script.setAttribute('data-strict', '0');
  script.setAttribute('data-reactions-enabled', '1');
  script.setAttribute('data-emit-metadata', '0');
  script.setAttribute('data-input-position', 'bottom');
  script.setAttribute('data-theme', 'preferred_color_scheme');
  script.setAttribute('data-lang', '{{ $giscusLanguage }}');
  script.setAttribute('data-loading', 'lazy');
  script.crossOrigin = 'anonymous';
  script.async = true;
  setTimeout(()=>{
    document.body.appendChild(script);
    console.log("Giscus loaded");
  }, 100)
}
loadGiscus()
</script>

{{- /* Disqus */ -}}
{{ if eq site.BaseURL "https://cyrusyip.org/" }}
  {{- $pc := .Site.Config.Privacy.Disqus -}}
  {{- if not $pc.Disable -}}
  {{ if .Site.Config.Services.Disqus.Shortname }}
  <script>
      window.disqus_config = function () {
      {{with .Params.disqus_identifier }}this.page.identifier = '{{ . }}';{{end}}
      {{with .Params.disqus_title }}this.page.title = '{{ . }}';{{end}}
      {{with .Params.disqus_url }}this.page.url = '{{ . | html  }}';{{end}}
      this.language = "{{ $disqusLanguage }}"
      };
      (function() {
          if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
              document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
              return;
          }
          var d = document, s = d.createElement('script'); s.async = true;
          s.src = '//' + {{ .Site.Config.Services.Disqus.Shortname }} + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          setTimeout(()=>{
            d.body.appendChild(s);
            console.log('Disqus loaded')
          }, 100)
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>{{end}}
  {{- end -}}
{{ end }}

{{ end }}